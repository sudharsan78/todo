{% load staticfiles %}
<!DOCTYPE html>
<html>
<head>
	<title>Todo</title>
</head>
<body>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js" type="text/javascript"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js" type="text/javascript"></script>
<!--
<script src="{% static 'todolist/vendor/jquery-2.2.3.js' %}"></script>
<script src="{% static 'todolist/vendor/underscore.js' %}"></script>
<script src="{% static 'todolist/vendor/backbone.js' %}"></script>
-->


<div id = "taskid">

<script type="text/template" id="addtask-item-tmpl">
<input></input>
  <button >Add</button>
</script>


<script type="text/template" id="todotask-item-tmpl">
  <%= id %> <%= task %> (<%= completed %>) <button id = "remove_task" data-id=" + this.model.get('id')">Remove</button>
</script>

</div>

<script type="text/javascript">
  

 var TodoModel = Backbone.Model.extend({
  defaults: {
    task: '',
    completed: false
  }
});

var TodoCollection = Backbone.Collection.extend({
  model: TodoModel,
  url: 'http://localhost:5000/api/v1/todo/',
  initialize: function(){
    this.on('delete', this.remove);
  }
 
});
var todocollection = new TodoCollection();

var TodoItem = Backbone.View.extend({
  el: "#taskid",
  
  initialize: function(){
    this.template = _.template($("#todotask-item-tmpl").html());
    this.collection.fetch({
      success: function(){
        console.log(this.collection);
      }
    });
    this.collection.bind('reset', this.render, this);
  },
  /*events:{
    'click #remove_task': 'del_task',

  },
  del_task: function()
  {
    this.model.destroy();
  },*/

  render: function(){
    //var tasklist = this.collection.toJSON();
    console.log(this.collection.toJSON);
    //todocollection.each(function(todo){
    _(this.collection.models).each(function(item){
      var todolistitemview = new TodoListItemView({ model: item });
      this.$el.append(todolistitemview.render().el);
    }, this);
    return this;
  }
});

var TodoListItemView = Backbone.View.extend({
  tagName: 'li',
  template: _.template($("#todotask-item-tmpl").html()),
  events: {
    "click #remove_task": 'taskremove'
  },

   render: function() {
    var html = this.template(this.model.toJSON());
    this.$el.html(html);
    return this;
  },
  taskremove: function(task){
    this.remove();
    this.model.destroy();
    this.model.trigger('delete', this.model);
    //var id = $(task.currentTarget).data('id');
    //this.collection.remove(id).destroy();
  },
});

todocollection.reset();
var todoitem = new TodoItem({ collection: todocollection});
/*
var taskview = Backbone.View.extend({
  tagName: 'ul',

  initialize: function(){
    this.collection.on('add', this.addtask, this);

  },
  render: function(){
    this.collection.each(this.addtask, this);
    return this;
    }, 
    addtask: function(task){
      var task = new taskview({model: TodoModel});
      this.$el.append(task.render().el );
    }
  
});*/




</script>

</body>
</html>
