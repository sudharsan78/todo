{% load staticfiles %}
<!DOCTYPE html>
<html>
<head>
	<title>Todo</title>
</head>
<body>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js" type="text/javascript"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js" type="text/javascript"></script>


<div id = "taskid"></div>

<script type="text/template" id="todotask-item-tmpl">
  <%= task %> (<%= completed %>) 
</script>

<script type="text/javascript">
  
 var TodoModel = Backbone.Model.extend({
  defaults: {
    task: '',
    completed: false
  }
});

var TodoCollection = Backbone.Collection.extend({
  model: TodoModel,
  url: 'http://localhost:8000/api/v1/todo',
 
});
var todocollection = new TodoCollection();

var TodoItem = Backbone.View.extend({
  el: "#taskid",
  
  initialize: function(){
    this.template = _.template($("#todotask-item-tmpl").html());
    this.collection.fetch({
      success: function(){
        console.log(this.collection);
      }
    });
    this.collection.bind('reset', this.render, this);
  },
  render: function(){
    //var tasklist = this.collection.toJSON();
    console.log(this.collection.toJSON);
    //todocollection.each(function(todo){
    _(this.collection.models).each(function(item){
      var todolistitemview = new TodoListItemView({ model: item });
      this.$el.append(todolistitemview.render().el);
    }, this);
    return this;
  }
});

var TodoListItemView = Backbone.View.extend({
  tagName: 'li',
  template: _.template($("#todotask-item-tmpl").html()),

   render: function() {
    var html = this.template(this.model.toJSON());
    this.$el.html(html);
    return this;
  }
});

todocollection.reset();
var todoitem = new TodoItem({ collection: todocollection});
/*
var taskview = Backbone.View.extend({
  tagName: 'ul',

  initialize: function(){
    this.collection.on('add', this.addtask, this);

  },
  render: function(){
    this.collection.each(this.addtask, this);
    return this;
    }, 
    addtask: function(task){
      var task = new taskview({model: TodoModel});
      this.$el.append(task.render().el );
    }
  
});


var TodoView = Backbone.View.extend({
  tagName: 'li',
  template: _.template( $('#todotask-item-tmpl').html()),

  initialize: function(){
    this.render();
  },

  render: function(){
    this.$el.html(this.template(this.model.toJSON()));
  }
});*/


//$(document.body).append(todoitem.render().el);


/*
var TodoListView = Backbone.View.extend({
  el: '#todo-app',

  initialize: function() {
    this.listenTo(this.collection, 'sync', this.render);
  },

  render: function() {
    var $list = this.$('ul.todo-list').empty();

    this.collection.each(function(model) {
      var item = new TodoListItemView({model: model});
      $list.append(item.render().$el);
    }, this);

    return this;
  }


}); */

</script>

</body>
</html>
